<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predefined Search Queries</title>
    <link rel="stylesheet" href="css/output.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100 flex flex-col items-center min-h-screen">

    <header class="text-gray-600 body-font w-full">
        <div class="container mx-auto flex flex-wrap p-5 flex-col md:flex-row items-center">
            <a class="flex title-font font-medium items-center text-gray-900 mb-4 md:mb-0">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round"
                    stroke-linejoin="round" stroke-width="2" class="w-10 h-10 text-white p-2 bg-indigo-500 rounded-full"
                    viewBox="0 0 24 24">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                </svg>
                <span class="ml-3 text-xl">ArticleFinder</span>
            </a>
        </div>
    </header>

    <!-- Ad Area Top -->
    <div class="ad-area w-11/12 bg-white shadow p-4 my-2 max-h-1/3 overflow-y-auto">
        <% adLists.adList1.forEach(ad=> { %>
            <div class="mb-2 text-blue-600 font-semibold bg-green-100">
                <%= ad %>
            </div>
            <% }) %>
    </div>

    <!-- App Area -->
    <div class="app-area w-11/12 bg-white shadow flex flex-grow my-2 max-h-screen">
        <!-- Left Section -->
        <div class="left w-2/5 p-4 border-r overflow-y-auto">
            <div id="results" class="results"></div>
        </div>

        <!-- Middle Section -->
        <div class="middle w-1/5 p-4 border-r">
            <div class="ad-area bg-white shadow p-4 my-1 max-h-72 overflow-y-auto w-full">
                <% adLists.adList3.forEach(ad=> { %>
                    <div class="mb-2 text-blue-600 font-semibold bg-green-100">
                        <%= ad %>
                    </div>
                    <% }) %>
            </div>
            <div class="instructions my-4 text-gray-700 max-h-48 overflow-y-auto">Click the buttons by the right to
                generate results.</div>
            <div class="timer text-gray-700">Countdown Timer</div>
        </div>

        <!-- Right Section -->
        <div class="right w-2/5 p-4 flex flex-col">
            <div class="search-controls flex flex-col space-y-2">
                <select id="site-select" class="p-2 border rounded">
                    <option value="">Select a site</option>
                    <% sites.forEach(site=> { %>
                        <option value="<%= site %>">
                            <%= site %>
                        </option>
                        <% }) %>
                </select>
                <div class="preset-buttons flex flex-col space-y-2 max-h-96 overflow-y-auto">
                    <% searchPresets.forEach(preset=> { %>
                        <button class="preset-button p-2 bg-blue-300 text-white rounded cursor-not-allowed"
                            data-preset="<%= preset %>" disabled>
                            <%= preset %>
                        </button>
                        <% }) %>
                </div>
                <!-- <button id="copy-urls" class="p-2 bg-green-500 text-white rounded hover:bg-green-700">Copy All
                    URLs</button> -->
            </div>
        </div>
    </div>

    <!-- Ad Area Bottom -->
    <div class="ad-area w-11/12 bg-white shadow p-4 my-2 max-h-1/3 overflow-y-auto">
        <% adLists.adList2.forEach(ad=> { %>
            <div class="mb-2 text-blue-600 font-semibold bg-green-100">
                <%= ad %>
            </div>
            <% }) %>
    </div>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded shadow-md text-center">
            <p class="text-lg font-semibold">Copied to Clipboard</p>
        </div>
    </div>

    <script>
        const siteSelect = document.getElementById('site-select');
        const presetButtons = document.querySelectorAll('.preset-button');

        siteSelect.addEventListener('change', () => {
            const site = siteSelect.value;
            presetButtons.forEach(button => {
                if (site) {
                    button.classList.remove('bg-blue-300', 'cursor-not-allowed');
                    button.classList.add('bg-blue-500', 'hover:bg-blue-700', 'cursor-pointer');
                    button.disabled = false;
                } else {
                    button.classList.add('bg-blue-300', 'cursor-not-allowed');
                    button.classList.remove('bg-blue-500', 'hover:bg-blue-700', 'cursor-pointer');
                    button.disabled = true;
                }
            });
        });

        document.querySelectorAll('.preset-button').forEach(button => {
            button.addEventListener('click', () => {
                const preset = button.getAttribute('data-preset');
                const site = document.getElementById('site-select').value;
                searchGoogle(site, preset);
            });
        });

        function searchGoogle(site, preset) {
            fetch('/api/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ site, preset })
            })
                .then(response => response.json())
                .then(data => {
                    const resultsDiv = document.getElementById('results');
                    resultsDiv.innerHTML = '';
                    if (data.length > 0) {
                        data.forEach(item => {
                            const resultItem = document.createElement('div');
                            resultItem.classList.add('result-item', 'mb-4', 'p-2', 'border-b');
                            resultItem.innerHTML = `
                                <h3 class="text-lg font-semibold"><a href='${item.link}' target='_blank'>${item.title}</a></h3>
                                <p class="text-gray-700">${item.snippet}</p>
                                <button class="copy-url-button p-1 bg-green-500 text-white rounded hover:bg-green-700" data-url='${item.link}'>Copy URL</button>
                            `;
                            resultsDiv.appendChild(resultItem);
                        });
                        addCopyButtonListeners();
                    } else {
                        resultsDiv.innerHTML = '<p>No results found.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching search results:', error);
                });
        }

        function addCopyButtonListeners() {
            document.querySelectorAll('.copy-url-button').forEach(button => {
                button.addEventListener('click', () => {
                    const url = button.getAttribute('data-url');
                    navigator.clipboard.writeText(url).then(() => {
                        showModal();
                    });
                });
            });
        }

        function showModal() {
            const modal = document.getElementById('modal');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 2000);
        }

        document.getElementById('copy-urls').addEventListener('click', () => {
            const results = document.querySelectorAll('.result-item h3 a');
            const urls = Array.from(results).map(result => result.href).join('\n');
            navigator.clipboard.writeText(urls).then(() => {
                showModal();
            });
        });
    </script>
</body>

</html>